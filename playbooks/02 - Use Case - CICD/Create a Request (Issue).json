{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Create a Request (Issue)",
    "aliasName": null,
    "tag": null,
    "description": "Creates a Source Control Issue against the FortiSOAR Content or Settings Repository with the request content",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/4c58fed3-9e16-451a-9528-0be2b71acda4",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/9b3eba7c-8cc9-4c39-aea5-05b2df668ae4",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Check Source Control Connector Configuration",
            "description": null,
            "arguments": {
                "arguments": [],
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "\/api\/3\/workflows\/dd654cd4-923f-4c20-837c-279669c2fa82"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "85cba27a-af44-4e37-a0c9-9fddf9598f16"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "cicd_env": "{{globalVars.cicd_env}}",
                "repo_name": "{{vars.cicd_config.content.split('\/')[-1]}}",
                "assigneeUsername": "{{vars.USER_MAPPING.get(vars.steps.Get_Change_Request_Details.input.assignee)}}"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "20429145-4b50-4df0-a0c8-cde5d66ccd7e"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Branch",
            "description": null,
            "arguments": {
                "arguments": {
                    "connector_config_id": "{{vars.steps.Check_Source_Control_Connector_Configuration['config_id']}}",
                    "create_branch_params": "{\"org_name\": \"{{vars.cicd_config.organizationName}}\",\"repo_name\": \"{{vars.cicd_config.contentRepoName}}\",\"new_branch\": \"CR-{{vars.steps.Create_Issue.data.number | string}}\",\"branch_name\": \"{{vars.cicd_config.baseBranch}}\",\"base_branch_or_sha\": \"Branch Name\"}"
                },
                "apply_async": false,
                "ignore_errors": true,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "{{vars.cicd_env[\"source_control_playbooks\"][\"CreateBranch\"][\"@id\"]}}"
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "ef404be3-62aa-4dac-8a59-e8caa1db9eb7"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Issue",
            "description": null,
            "arguments": {
                "arguments": {
                    "connector_config_id": "{{vars.steps.Check_Source_Control_Connector_Configuration['config_id']}}",
                    "create_issue_params": "{\"org_name\": \"{{vars.cicd_config.organizationName}}\",\"repo_name\": \"{{vars.cicd_config.contentRepoName}}\",\"issue_title\": \"{{vars.steps.Get_Change_Request_Details.input.summary}}\",\"issue_content\": \"{{vars.steps.Get_Change_Request_Details.input.description}}\",\"issue_assignee\": \"{{[vars.assigneeUsername]}}\"}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": true,
                "workflowReference": "{{vars.cicd_env[\"source_control_playbooks\"][\"CreateIssue\"][\"@id\"]}}"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "142799f7-839a-4e01-b9a1-962a8d7a826d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Change Request Details",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "Create New Request",
                        "description": "Creates a new change request (issue) on {{vars.cicd_config.contentRepoName}} repository.",
                        "inputVariables": [
                            {
                                "name": "summary",
                                "type": "string",
                                "label": "Summary",
                                "tooltip": "Provide the Summary of Change Request",
                                "dataType": "text",
                                "formType": "text",
                                "required": true,
                                "_expanded": true,
                                "defaultValue": null,
                                "_previousName": "",
                                "jinjaExpressionView": true,
                                "useRecordFieldDefault": false
                            },
                            {
                                "name": "description",
                                "type": "string",
                                "label": "Description",
                                "title": "Rich Text (HTML)",
                                "usable": true,
                                "tooltip": "Provide the Description of Change Request",
                                "dataType": "text",
                                "formType": "html",
                                "required": true,
                                "_expanded": true,
                                "mmdUpdate": true,
                                "collection": false,
                                "searchable": true,
                                "templateUrl": "app\/components\/form\/fields\/htmlEditor.html",
                                "defaultValue": "",
                                "_previousName": "description",
                                "playbookField": true,
                                "lengthConstraint": true,
                                "allowedEncryption": true,
                                "allowedGridColumn": true,
                                "jinjaExpressionView": true,
                                "useRecordFieldDefault": false
                            },
                            {
                                "name": "assignee",
                                "type": "array",
                                "label": "Assignee",
                                "title": "Dynamic List",
                                "usable": true,
                                "options": "{{vars.user_list}}",
                                "tooltip": "Select the Change Request Assignee Username",
                                "dataType": "dynamicList",
                                "formType": "dynamicList",
                                "required": true,
                                "_expanded": true,
                                "mmdUpdate": true,
                                "collection": false,
                                "searchable": false,
                                "templateUrl": "app\/components\/form\/fields\/dynamicList.html",
                                "defaultValue": null,
                                "_previousName": "assignee",
                                "playbookField": true,
                                "lengthConstraint": true,
                                "allowedGridColumn": false,
                                "jinjaExpressionView": true,
                                "useRecordFieldDefault": false
                            }
                        ]
                    }
                },
                "record": "",
                "agent_id": null,
                "resources": "change_management",
                "is_approval": false,
                "owner_detail": {
                    "isAssigned": false,
                    "emailRecipients": ""
                },
                "isRecordLinked": false,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "Submit",
                            "primary": true,
                            "step_iri": "\/api\/3\/workflow_steps\/20429145-4b50-4df0-a0c8-cde5d66ccd7e"
                        }
                    ],
                    "duplicateOption": false,
                    "customSuccessMessage": "Awaiting Playbook resumed successfully."
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "customEmailExternal": false,
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false,
                "external_email_subject": null,
                "internal_email_subject": "A FortiSOAR playbook is requesting your input",
                "custom_email_body_external": null,
                "external_email_attachments": null
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "f87d6e93-7ed0-4a73-b3a8-0dba10b70241"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Source Control Details",
            "description": null,
            "arguments": {
                "params": {
                    "iri": "\/api\/wf\/api\/dynamic-variable\/?limit=50&name=cicd_config",
                    "body": "",
                    "method": "GET"
                },
                "version": "3.2.6",
                "connector": "cyops_utilities",
                "operation": "make_cyops_request",
                "operationTitle": "FSR: Make FortiSOAR API Call",
                "step_variables": {
                    "cr_info": "{}",
                    "cicd_config": "{{vars.result.data['hydra:member'][0].value | toDict }}"
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "aa6d9b92-8a27-463a-94d0-63c28fef2630"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Users",
            "description": null,
            "arguments": {
                "params": {
                    "iri": "\/api\/3\/people",
                    "body": "",
                    "method": "GET"
                },
                "version": "3.2.6",
                "connector": "cyops_utilities",
                "operation": "make_cyops_request",
                "operationTitle": "FSR: Make FortiSOAR API Call",
                "step_variables": {
                    "user_list": "{% set user_list = [] %}{% for user in vars.steps.Get_Users.data['hydra:member'] %}{% if user['sourceControlUsername'] != None %}{% set _=user_list.append(user.firstname + \" \"+ (user.lastname or \"\")) %}{% endif %}{% endfor %}{{user_list}}",
                    "USER_MAPPING": "{% set user_mapping = {} %}{% for user in vars.steps.Get_Users.data['hydra:member'] %}{% if user['sourceControlUsername'] != None %}{% set _=user_mapping.update({user.firstname + \" \"+ (user.lastname or \"\") : user.sourceControlUsername }) %}{% endif %}{% endfor %}{{user_mapping}}"
                }
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "902690e1-0853-48a8-8244-a10801612e20"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "05c8ab55-37b7-4d2a-877f-39db0cc73777",
                "title": "Create New Request",
                "resources": [
                    "change_management"
                ],
                "__triggerLimit": true,
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "_promptexpanded": true,
                "triggerOnSource": true,
                "executeButtonText": "Submit",
                "noRecordExecution": true,
                "showToasterMessage": {
                    "visible": false,
                    "messageVisible": true
                },
                "triggerOnReplicate": false,
                "singleRecordExecution": false
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "9b3eba7c-8cc9-4c39-aea5-05b2df668ae4"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Check Source Control Connector Configuration -> Get Source Control Details",
            "targetStep": "\/api\/3\/workflow_steps\/aa6d9b92-8a27-463a-94d0-63c28fef2630",
            "sourceStep": "\/api\/3\/workflow_steps\/85cba27a-af44-4e37-a0c9-9fddf9598f16",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "f0f75937-2e1e-4645-aa8b-97e768e9df16"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Create Issue",
            "targetStep": "\/api\/3\/workflow_steps\/142799f7-839a-4e01-b9a1-962a8d7a826d",
            "sourceStep": "\/api\/3\/workflow_steps\/20429145-4b50-4df0-a0c8-cde5d66ccd7e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "4bcdd94c-f279-4203-b2e7-0cf60496faf7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Iss -> Create Branch",
            "targetStep": "\/api\/3\/workflow_steps\/ef404be3-62aa-4dac-8a59-e8caa1db9eb7",
            "sourceStep": "\/api\/3\/workflow_steps\/142799f7-839a-4e01-b9a1-962a8d7a826d",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8663eaf3-765e-444b-8973-7c5d62678ea7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create New Request -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/20429145-4b50-4df0-a0c8-cde5d66ccd7e",
            "sourceStep": "\/api\/3\/workflow_steps\/f87d6e93-7ed0-4a73-b3a8-0dba10b70241",
            "label": "Submit",
            "isExecuted": false,
            "group": null,
            "uuid": "fce529fa-5b2d-4a67-bcc6-c8c35ba4808a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Source Control Details -> Get Users",
            "targetStep": "\/api\/3\/workflow_steps\/902690e1-0853-48a8-8244-a10801612e20",
            "sourceStep": "\/api\/3\/workflow_steps\/aa6d9b92-8a27-463a-94d0-63c28fef2630",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "d79c1cf7-9b4f-49ac-98ae-a117f07dd243"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Users -> hgvh",
            "targetStep": "\/api\/3\/workflow_steps\/f87d6e93-7ed0-4a73-b3a8-0dba10b70241",
            "sourceStep": "\/api\/3\/workflow_steps\/902690e1-0853-48a8-8244-a10801612e20",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "7405cc1b-cc6f-43e3-930b-e651e7a9a141"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Check Source Control Connector Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/85cba27a-af44-4e37-a0c9-9fddf9598f16",
            "sourceStep": "\/api\/3\/workflow_steps\/9b3eba7c-8cc9-4c39-aea5-05b2df668ae4",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "12f79c69-b8b2-4565-8469-3aee9bed4c45"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "c0d9f6b2-19e5-4a81-9802-731f26bed58d",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "CICD",
        "ManualAction"
    ]
}